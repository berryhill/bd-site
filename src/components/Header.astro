---
import Hr from "./Hr.astro";
import IconMoon from "@/assets/icons/IconMoon.svg";
import IconSearch from "@/assets/icons/IconSearch.svg";
import IconSunHigh from "@/assets/icons/IconSunHigh.svg";
import LinkButton from "./LinkButton.astro";
import { SITE } from "@/config";

const { pathname } = Astro.url;

// Remove trailing slash from current pathname if exists
const currentPath =
  pathname.endsWith("/") && pathname !== "/" ? pathname.slice(0, -1) : pathname;

const isActive = (path: string) => {
  const currentPathArray = currentPath.split("/").filter(p => p.trim());
  const pathArray = path.split("/").filter(p => p.trim());

  return currentPath === path || currentPathArray[0] === pathArray[0];
};
---

<header>
  <a
    id="skip-to-content"
    href="#main-content"
    style="position: absolute; left: 64px; top: -100%; z-index: 50; background: var(--background); padding: 12px; color: var(--accent); border: 2px solid var(--border);"
  >
    Skip to content
  </a>
  <div
    id="nav-container"
    style="max-width: 1200px; margin: 0 auto; border: 3px solid var(--border); padding: 15px; margin-bottom: 0; background: var(--background);"
  >
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
      <a
        href="/"
        style="text-decoration: none; font-weight: bold; font-size: 18px; color: var(--accent);"
      >
        [{SITE.title}]
      </a>

      <nav style="display: flex; align-items: center; gap: 15px;">
        <a href="/posts" class:list={{ "active-nav": isActive("/posts") }} style="text-decoration: none; padding: 5px 10px; border: 2px solid var(--border); background: var(--background); font-weight: bold; display: inline-block;">
          [POSTS]
        </a>
        <a href="/tags" class:list={{ "active-nav": isActive("/tags") }} style="text-decoration: none; padding: 5px 10px; border: 2px solid var(--border); background: var(--background); font-weight: bold; display: inline-block;">
          [TAGS]
        </a>
        <a href="/about" class:list={{ "active-nav": isActive("/about") }} style="text-decoration: none; padding: 5px 10px; border: 2px solid var(--border); background: var(--background); font-weight: bold; display: inline-block;">
          [ABOUT]
        </a>
        <LinkButton
          href="/search"
          class:list={[
            { "active-nav": isActive("/search") },
          ]}
          ariaLabel="search"
          title="Search"
          style="padding: 5px 10px; border: 2px solid var(--border); background: var(--background); font-weight: bold;"
        >
          [SEARCH]
        </LinkButton>
        {
          SITE.lightAndDarkMode && (
            <button
              id="theme-btn"
              style="padding: 5px 10px; border: 2px solid var(--border); background: var(--background); cursor: pointer; font-weight: bold;"
              title="Toggles light & dark"
              aria-label="auto"
              aria-live="polite"
            >
              [THEME]
            </button>
          )
        }
      </nav>
    </div>
  </div>
</header>

<script>
  // No smooth transitions - instant theme switch
  function initThemeToggle() {
    const themeBtn = document.querySelector("#theme-btn");
    if (!themeBtn) return;

    themeBtn.addEventListener("click", () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
      html.setAttribute("data-theme", currentTheme);
      localStorage.setItem("theme", currentTheme);
    });
  }

  initThemeToggle();
  document.addEventListener("astro:after-swap", initThemeToggle);
</script>
