@plugin '@tailwindcss/typography';

@layer base {
  /* ===== Override default Tailwind Typography styles ===== */
  .app-prose {
    @apply prose prose-lg;

    h1,
    h2,
    h3,
    h4,
    th {
      margin-bottom: 0.75rem;
      color: var(--foreground);
    }

    h3 {
      font-style: italic;
    }

    p,
    strong,
    ol,
    ul,
    figcaption,
    table,
    code {
      color: var(--foreground);
    }

    /* Ensure better contrast for body text */
    p {
      opacity: 0.9;
    }

    a {
      word-break: break-word;
      color: var(--foreground);
      text-decoration-line: underline;
      text-decoration-style: dashed;
      text-underline-offset: 4px;
    }

    a:hover {
      color: var(--accent);
    }

    a:focus-visible {
      text-decoration: none;
    }

    ul {
      overflow-x: clip;
    }

    li::marker {
      color: var(--accent);
    }

    hr {
      border-color: var(--border);
    }

    img {
      margin-left: auto;
      margin-right: auto;
      border: 1px solid var(--border);
    }

    figcaption {
      opacity: 0.75;
    }

    table th,
    table td {
      border: 1px solid var(--border);
      padding: 0.5rem;
    }

    table th {
      padding-top: 0.375rem;
      padding-bottom: 0.375rem;
    }

    table code {
      word-break: break-all;
    }

    @media (min-width: 640px) {
      table code {
        word-break: normal;
      }
    }

    code {
      border-radius: 0.25rem;
      background-color: rgb(var(--muted) / 0.75);
      padding: 0.25rem;
      word-break: break-word;
      color: var(--foreground);
    }

    code::before,
    code::after {
      content: none;
    }

    .astro-code code {
      flex: 1 0 100%;
      background-color: inherit;
      padding: 0;
    }

    blockquote {
      border-inline-start-color: rgb(var(--accent) / 0.8);
      word-break: break-word;
      opacity: 0.8;
    }

    details {
      display: inline-block;
      cursor: pointer;
      color: var(--foreground);
      user-select: none;
    }

    details p {
      display: none;
    }

    details ul {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }

    summary:focus-visible {
      text-decoration: none;
      outline-width: 2px;
      outline-offset: 1px;
      outline-color: var(--accent);
      outline-style: dashed;
    }

    pre:focus-visible {
      border-color: transparent;
      outline-width: 2px;
      outline-color: var(--accent);
      outline-style: dashed;
    }
  }

  /* ===== Code Blocks & Syntax Highlighting ===== */
  .astro-code {
    @apply flex border bg-(--shiki-light-bg) text-(--shiki-light) outline-border [&_span]:text-(--shiki-light);
  }

  html[data-theme="dark"] .astro-code {
    @apply bg-(--shiki-dark-bg) text-(--shiki-dark) [&_span]:text-(--shiki-dark);
  }

  /* Styles for Shiki transformers */
  /* https://shiki.style/packages/transformers */
  .astro-code {
    .line.diff.add {
      @apply relative inline-block w-full bg-green-400/20 before:absolute before:-left-3 before:text-green-500 before:content-['+'];
    }
    .line.diff.remove {
      @apply relative inline-block w-full bg-red-500/20 before:absolute before:-left-3 before:text-red-500 before:content-['-'];
    }
    .line.highlighted {
      @apply inline-block w-full bg-slate-400/20;
    }
    .highlighted-word {
      @apply rounded-sm border border-border px-0.5 py-px;
    }
  }
}
