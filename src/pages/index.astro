---
export const prerender = true;

import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <!-- Hero Section - Algorithmic Brutalism -->
    <section id="hero">
      <!-- ASCII art header -->
      <pre style="font-size: 14px; line-height: 1.2; margin-bottom: 20px; overflow-x: auto;">╔══════════════════════════════════════════════╗
║   BERRYHILL.DEV                              ║
║   ALGORITHMIC BRUTALISM                      ║
╚══════════════════════════════════════════════╝</pre>

      <!-- Raw heading -->
      <h1>
        WELCOME_TO_MY_<br>CORNER_OF_THE_<br>INTERNET
      </h1>

      <!-- Exposed list -->
      <ul style="list-style: none; padding: 0; margin: 20px 0; font-size: 18px; line-height: 1.8;">
        <li>[X] AGENTIC-FIRST DEVELOPMENT</li>
        <li>[X] AI/ML SYSTEMS</li>
        <li>[X] WEB3 SMART CONTRACTS</li>
        <li>[X] INTELLIGENT AUTOMATION</li>
      </ul>

      <!-- Raw links -->
      <div style="margin-top: 30px; display: flex; gap: 20px; flex-wrap: wrap;">
        <a href="/rss.xml" style="border: 2px solid var(--border); padding: 10px 20px; background: var(--background); text-decoration: none; font-weight: bold; display: inline-block;">[RSS_FEED]</a>
        <a href="/posts/" style="border: 2px solid var(--border); padding: 10px 20px; background: var(--background); text-decoration: none; font-weight: bold; display: inline-block;">[ALL_POSTS]</a>
        <a href="/search/" style="border: 2px solid var(--border); padding: 10px 20px; background: var(--background); text-decoration: none; font-weight: bold; display: inline-block;">[SEARCH]</a>
      </div>

      <!-- Social links if present -->
      {
        SOCIALS.length > 0 && (
          <div style="margin-top: 30px; border-top: 2px solid var(--border); padding-top: 20px;">
            <span style="font-size: 14px; font-weight: bold; display: block; margin-bottom: 10px;">[CONNECT]</span>
            <Socials />
          </div>
        )
      }
    </section>

    <Hr />

    {
      featuredPosts.length > 0 && (
        <>
          <!-- Featured Posts - Algorithmic Brutalism -->
          <section id="featured">
            <pre style="font-size: 18px; line-height: 1.3; margin-bottom: 20px;">╔═══════════════════════╗
║ FEATURED_POSTS      ║
╚═══════════════════════╝</pre>
            <ul style="display: grid; grid-template-columns: 1fr; gap: 0; padding: 0;">
              {featuredPosts.map((data, index) => (
                <Card variant="h2" {...data} data-index={index} />
              ))}
            </ul>
          </section>
          {recentPosts.length > 0 && <Hr />}
        </>
      )
    }

    {
      recentPosts.length > 0 && (
        <!-- Recent Posts - Algorithmic Brutalism -->
        <section id="recent-posts">
          <pre style="font-size: 18px; line-height: 1.3; margin-bottom: 20px;">╔═══════════════════════╗
║ RECENT_POSTS        ║
╚═══════════════════════╝</pre>
          <ul style="display: grid; grid-template-columns: 1fr; gap: 0; padding: 0;">
            {recentPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} data-index={index} />
            )}
          </ul>
        </section>
      )
    }

    <!-- Brutal CTA -->
    <div style="margin: 40px 0; text-align: center;">
      <a href="/posts/" style="border: 3px solid var(--border); padding: 15px 30px; background: var(--background); text-decoration: none; font-weight: bold; display: inline-block; font-size: 18px;">
        ────────────────────>
        <br>[VIEW_ALL_POSTS]
        <br>────────────────────>
      </a>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
